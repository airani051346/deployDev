{% extends "base.html" %}
{% block title %}HW Types{% endblock %}
{% block content %}

<h2>Hardware Types</h2>

<div style="margin-bottom: 20px;">
  <input type="text" id="new-hwtype" placeholder="New HW Type" style="padding: 6px;">
  <button onclick="addHwType()" style="padding: 6px;">Add</button>
</div>

<table class="table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Type</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="hwtype-body">
    <!-- Will be populated by JS -->
  </tbody>
</table>

<script>
async function loadHwTypes() {
  const res = await fetch('/app/hwtypes');
  const types = await res.json();
  const tbody = document.getElementById('hwtype-body');
  tbody.innerHTML = '';

  types.forEach(t => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${t.id}</td>
      <td>
        <input type="text" value="${t.name}" id="type-${t.id}" style="padding: 4px; width: 200px;">
      </td>
      <td>
        <button id="apply-${t.id}" onclick="applyHwType(${t.id})">Apply</button>
        <button onclick="deleteHwType(${t.id})" style="color: red;">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

async function addHwType() {
  const input = document.getElementById('new-hwtype');
  const name = input.value.trim();
  if (!name) return alert("Type name cannot be empty.");

  const res = await fetch('/app/hwtypes', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name })
  });

  if (res.ok) {
    input.value = '';
    await loadHwTypes();
  } else {
    const error = await res.json();
    alert("Add failed: " + (error.error || 'Unknown error'));
  }
}

async function applyHwType(id) {
  const input = document.getElementById(`type-${id}`);
  const btn = document.getElementById(`apply-${id}`);
  const name = input.value.trim();
  if (!name) return alert("Type name cannot be empty.");

  btn.disabled = true;
  btn.textContent = 'Applying...';

  const res = await fetch(`/app/hwtypes/${id}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name })
  });

  if (res.ok) {
    btn.textContent = 'âœ” Applied';
    setTimeout(() => {
      btn.disabled = false;
      btn.textContent = 'Apply';
    }, 1000);
  } else {
    const error = await res.json();
    alert("Update failed: " + (error.error || 'Unknown error'));
    btn.disabled = false;
    btn.textContent = 'Apply';
  }
}

async function deleteHwType(id) {
  if (!confirm("Are you sure you want to delete this HW Type?")) return;

  const res = await fetch(`/app/hwtypes/${id}`, { method: 'DELETE' });

  if (res.ok) {
    await loadHwTypes();
  } else {
    const error = await res.json();
    alert("Delete failed: " + (error.error || 'Unknown error'));
  }
}

loadHwTypes();
</script>

{% endblock %}
